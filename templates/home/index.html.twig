{% extends 'base.html.twig' %}

{% block title %}Tableau de bord{% endblock %}

{% block body %}
    <div class="dash-headline-two">
        <div>
            <h4 class="tx-inverse mg-b-5">Bienvenue, {% if app.user is not null %}{{ app.user.fullName }}{% endif %}</h4>
            <p class="mg-b-0">{{"Aujourd'nhui nous sommes le : " ~ "now"|date("d/m/Y") }}</p>
        </div>
        <div class="d-h-t-right">
            <div class="summary-item">
                <h1>{{ stats.currentDayAmountSale ~ " F CFA" }}</h1>
                <span>Ventes <br>du jour</span>
            </div>
            <div class="summary-item">
                <h1>{{ stats.lastDayAmountSale ~ " F CFA" }}</h1>
                <span>Ventes<br>d'hier</span>
            </div>
        </div>
    </div><!-- dash-headline-two -->
    <div class="card card-dash-one mg-t-20">
        <div class="row no-gutters">
            <div class="col-lg-2">
                <i class="icon ion-ios-world-outline"></i>
                <div class="dash-content">
                    <label class="tx-danger">Qte Initial</label>
                    <h2>{{ stats.totalInit }}</h2>
                </div><!-- dash-content -->
            </div><!-- col-3 -->

            <div class="col-lg-2">
                <i class="icon ion-ios-stopwatch-outline"></i>
                <div class="dash-content">
                    <label class="tx-purple">Entrées en stock</label>
                    <h2>{{ stats.totalEntry }}</h2>
                </div><!-- dash-content -->
            </div><!-- col-3 -->


            <div class="col-lg-3">
                <i class="icon ion-ios-pie-outline"></i>
                <div class="dash-content">
                    <label class="tx-success">Qte de produits de Vendu</label>
                    <h2>{{ stats.totalSale }}</h2>
                </div><!-- dash-content -->
            </div><!-- col-3 -->


            <div class="col-lg-2">
                <i class="icon ion-ios-world-outline"></i>
                <div class="dash-content">
                    <label class="tx-danger">Sorties de Stock</label>
                    <h2>{{ stats.totalOut }}</h2>
                </div><!-- dash-content -->
            </div><!-- col-3 -->

            <div class="col-lg-3">
                <i class="icon ion-ios-analytics-outline"></i>
                <div class="dash-content">
                    <label class="tx-primary">Nbre de produits Disponible</label>
                    <h2>{{ stats.totalProductInStock }}</h2>
                </div><!-- dash-content -->
            </div><!-- col-2-->
        </div><!-- row -->
    </div><!-- card -->
    <div class="nav-statistics-wrapper">
        <nav class="nav">
            <a href="" class="nav-link active">Vue d'ensemble</a>
        </nav>
    </div><!-- nav-statistics-wrapper -->
    <div class="row row-statistics mg-b-30">
        <div class="col-md-5">
            <h1 class="tx-inverse tx-56 tx-lato tx-bold">{{ stats.currentWeekNumberOfSale }}</h1>
            <h6 class="tx-15 tx-inverse tx-bold mg-b-20">Résumé des ventes de la semaine</h6>
            <p>Ce tableau présente de résumé de votre chiffres d'affaire de ce mois</p>
        </div><!-- col-5 -->
        <div class="col-md-7 mg-t-20 mg-md-t-0">
            <h6 class="slim-card-title mg-b-15">Votre revenu</h6>
            <div class="row no-gutters">
                    <div class="col-sm-6">
                        <div class="card card-earning-summary">
                            <h6>Revenue du jour</h6>
                            <h1>{{ stats.currentDayAmountSale ~ " F CFA" }}</h1>
                            <span>Basé sur les prix de ventes</span>
                        </div><!-- card -->
                    </div><!-- col-6 -->
                    <div class="col-sm-6">
                        <div class="card card-earning-summary mg-sm-l--1 bd-t-0 bd-sm-t">
                            <h6>Revenue de la semaine</h6>
                            <h1>{{ stats.currentWeekAmountSale ~ " F CFA" }}</h1>
                            <span>Basé sur les prix de ventes</span>
                        </div><!-- card -->
                    </div><!-- col-6 -->
                </div><!-- row -->
            <div class="row no-gutters">
                <div class="col-sm-6">
                    <div class="card card-earning-summary">
                        <h6>Revenue du mois</h6>
                        <h1>{{ stats.currentMonthAmountSale ~ " F CFA" }}</h1>
                        <span>Basé sur les prix de ventes</span>
                    </div><!-- card -->
                </div><!-- col-6 -->
                <div class="col-sm-6">
                    <div class="card card-earning-summary mg-sm-l--1 bd-t-0 bd-sm-t">
                        <h6>Commande du mois</h6>
                        <h1>{{ stats.currentMonthAmountCommand ~ " F CFA" }}</h1>
                        <span>Basé sur les prix d'achats</span>
                    </div><!-- card -->
                </div><!-- col-6 -->
            </div><!-- row -->
        </div><!-- col-7 -->


    </div><!-- row -->

    <hr>
    <div class="row no-gutters dashboard-chart-one">
        <div class="col-md-4 col-lg">
            <div class="card card-total">
                <div>
                    <h4>{{ stats.totalProductInStock }}</h4>
                    <p>Etat du stock</p>
                </div>

            </div><!-- card -->
        </div><!-- col -->
        <div class="col-md-4 col-lg">
            <div class="card card-total">
                <div>
                    <h4>{{ stats.productOutOfStock | length }}</h4>
                    <p>Produit en rupture</p>
                </div>
            </div><!-- card -->
        </div><!-- col -->
        <div class="col-md-4 col-lg">
            <div class="card card-total">
                <div>
                    <h4>{{ stats.totalProductInStockValue ~" F CFA" }}</h4>
                    <p>Valeur du stock</p>
                </div>
            </div><!-- card -->
        </div><!-- col -->
        <div class="col-md col-lg-4">
            <div class="card card-revenue">
                <p>Revenu du {{ "now"|date("F Y") }}</p>
                {%  set percent =  ((stats.currentMonthAmountSale - stats.lastMonthAmountSale)/stats.lastMonthAmountSale)*100 | round  %}
                <h4>{{ stats.currentMonthAmountSale ~" F CFA" }} <span class="{% if (percent > 0) %}tx-success{% else %} tx-danger {% endif %}">{{ percent }}% </span></h4>
                <label>Revenue Mois de {{ "now"|date_modify("-1 month")|date("F Y") }}: <span>{{ stats.lastMonthAmountSale ~" F CFA" }}</span></label>
            </div><!-- card -->
        </div><!-- col-4 -->
    </div><!-- row -->

    <hr>

    <div class="report-summary-header">
        <div>
            <h4 class="tx-inverse mg-b-3">Les produits les plus demandées</h4>
            <p class="mg-b-0"><i class="icon ion-calendar mg-r-3"></i> {{"now"|date("F Y")~" - "~"now"|date_modify("-1 month")|date("F Y") }}</p>
        </div>
        <div>
            <a href="#" class="btn btn-secondary">Top Produits Vendus</a>
            <a href="#" class="btn btn-secondary">Voir tous les produits</a>
        </div>
    </div><!-- d-flex -->

    <div class="row row-sm">
        {% for product in stats.productMostSale %}
        <div class="col-md-6 col-lg-4">
            <div class="card card-popular-product">
                <h5 class="prod-name"><a href="">{{ product.name }}</a></h5>
                <p class="prod-by">Par: <a href="">{{ product.brandName }}</a></p>
                <div class="row">
                    <div class="col-5">
                        <h1>{{ product.totalSale }}</h1>
                        <p>Qte Vendu</p>
                    </div><!-- col -->
                    <div class="col-7">
                        <h1>{{ product.totalAmount ~" F CFA" }}</h1>
                        <p>Revenue</p>
                    </div><!-- col -->
                </div><!-- row -->
            </div><!-- card -->
        </div><!-- col-4 -->
        {% endfor %}
        {#<div class="col-md-6 col-lg-4 mg-t-20 mg-md-t-0">
            <div class="card card-popular-product">
                <label class="prod-id">Product ID: #PD-1753</label>
                <h5 class="prod-name"><a href="">US KS-5 Junior Lite DVD Karaoke 9500</a></h5>
                <p class="prod-by">By: <a href="">ThmPxls Security</a></p>
                <div class="row">
                    <div class="col-5">
                        <h1>1862</h1>
                        <p>Total Sales</p>
                    </div><!-- col -->
                    <div class="col-7">
                        <h1>$13,113</h1>
                        <p>Earnings</p>
                    </div><!-- col -->
                </div><!-- row -->
            </div><!-- card -->
        </div><!-- col-4 -->
        <div class="col-md-6 col-lg-4 mg-t-20 mg-lg-t-0">
            <div class="card card-popular-product">
                <label class="prod-id">Product ID: #PD-1754</label>
                <h5 class="prod-name"><a href="">US 360 Home Security IP Camera Night</a></h5>
                <p class="prod-by">By: <a href="">ThmPxls Digital</a></p>
                <div class="row">
                    <div class="col-5">
                        <h1>1799</h1>
                        <p>Total Sales</p>
                    </div><!-- col -->
                    <div class="col-7">
                        <h1>$11,091</h1>
                        <p>Earnings</p>
                    </div><!-- col -->
                </div><!-- row -->
            </div><!-- card -->
        </div><!-- col-4 #}{#-->#}

    </div><!-- row -->

    <hr>
    <div class="row row-xs mg-t-40 mg-b-40">
        <div class="col-lg-12">
            <div class="card card-table">
                <div class="card-header">
                    <h6 class="slim-card-title">Les produits en rupture de stock</h6>
                </div><!-- card-header -->
                <div class="table-responsive">
                    <table class="table mg-b-0 tx-13">
                        <thead>
                        <tr class="tx-10">
                            <th class="wd-10p pd-y-5">&nbsp;</th>
                            <th class="pd-y-5">Produit</th>
                            <th class="pd-y-5">Catégorie</th>
                            <th class="pd-y-5">Qté en stock</th>
                            <th class="pd-y-5">Qté en vendu</th>
                            <th class="pd-y-5">Prix Unitaire</th>
                        </tr>
                        </thead>
                        <tbody>
                        {% for product in stats.productOutOfStock %}
                        <tr>
                            <td class="pd-l-20">
                                <a href="#" class="logged-user">
                                <img src="{{ vich_uploader_asset(product) }}" alt="">
                                </a>
                            </td>
                            <td>
                                <a href="" class="tx-inverse tx-14 tx-medium d-block">{{ product.name }}</a>
                                <span class="tx-11 d-block">{{ product.codeBar }}</span>
                            </td>
                            <td class="tx-12">
                                {{product.category.name}}
                            </td>
                            <td>{{product.stockQte}}</td>
                            <td>{{ product.saleQte }}</td>
                            <td>{{ product.salePrice }}</td>
                        </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div><!-- table-responsive -->
                <div class="card-footer tx-12 pd-y-15 bg-transparent">
                    <a href=""><i class="fa fa-angle-down mg-r-5"></i>View All Transaction History</a>
                </div><!-- card-footer -->
            </div><!-- card -->
        </div><!-- col-12 -->
    </div>
{% endblock %}
